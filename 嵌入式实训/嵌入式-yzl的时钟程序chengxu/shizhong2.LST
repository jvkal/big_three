C51 COMPILER V8.02   SHIZHONG2                                                             08/10/2009 08:55:36 PAGE 1   


C51 COMPILER V8.02, COMPILATION OF MODULE SHIZHONG2
OBJECT MODULE PLACED IN shizhong2.OBJ
COMPILER INVOKED BY: D:\Program Files\Keil\C51\BIN\C51.EXE shizhong2.c BROWSE DEBUG OBJECTEXTEND

line level    source

   1             /**********************************************************************
   2          * 程序名;  时钟实验2
   3          * 功  能： 数码管通过动态扫描显示时间，时间可设定,调整时间时时钟照常走.
   4          * 编程者： ZPZ
   5          * 编程时间：2009/8/9
   6          **********************************************************************/
   7          #include<reg52.h>
   8          #define uint unsigned int 
   9          #define uchar unsigned char
  10                          
  11          sbit  _led=P2^7;
  12          sbit  key1=P2^0;
  13          sbit  key2=P2^1;
  14          sbit  key3=P2^2;
  15          uchar  num=0,temp=0,count=0;
  16          uchar  aa;
  17          uchar hour,min,sec;
  18          uchar code table[]={0xc0,0xf9,0xa4,0xb0,0x99,0x92,0x82,0xf8,0x80,0x90};
  19          
  20          void  delay(uint z);
  21          void display(uchar a,uchar b,uchar c,uchar d,uchar e,uchar f,uchar aa);
  22          void  read_key();
  23          void led();
  24          
  25          /****************** 主函数  *******************/
  26          void main()
  27          {
  28   1              P2=0xff;
  29   1              hour=12;
  30   1              min=0;
  31   1              sec=0;
  32   1              TMOD=0x11;
  33   1              TH0=(65536-50000)/256;
  34   1              TL0=(65536-50000)%256;
  35   1              TH1=(65536-50000)/256;
  36   1              TL1=(65536-50000)%256;
  37   1              EA=1;
  38   1              ET0=1;
  39   1              ET1=1;
  40   1              TR0=1;
  41   1              TR1=1;
  42   1          while(1)
  43   1          {   
  44   2                  
  45   2                      read_key();
  46   2                      if(temp>=20)
  47   2                      {
  48   3                       temp=0;
  49   3                   sec++;
  50   3                       if(sec>=60)
  51   3                         {
  52   4                                sec=0;
  53   4                                min++;
  54   4                                if(min>=60)
  55   4                                {
C51 COMPILER V8.02   SHIZHONG2                                                             08/10/2009 08:55:36 PAGE 2   

  56   5                                       min=0;
  57   5                                   hour++;
  58   5                                       if(hour>=24)
  59   5                                       {
  60   6                                              hour=0;
  61   6                                       }
  62   5                                }
  63   4                         }
  64   3                      }
  65   2                  if(count<=15)
  66   2                      display(table[hour/10],table[hour%10],table[min/10],
  67   2                               table[min%10],table[sec/10],table[sec%10],0xff);
  68   2                      if(count>15)
  69   2                  display(table[hour/10],table[hour%10],table[min/10],
  70   2                               table[min%10],table[sec/10],table[sec%10],0x00);                    
  71   2          }
  72   1      }
  73          
  74            
  75          /****************** 显示函数  *******************/
  76          void display(uchar a,uchar b,uchar c,uchar d,uchar e,uchar f,uchar aa)
  77          {    
  78   1          if(num==1){P1=0x01&aa;P0=a;delay(2);}else{P1=0x01;P0=a;delay(2);}   //hour
  79   1          if(num==1){P1=0x02&aa;P0=b;delay(2);}else{P1=0x02;P0=b;delay(2);}  //hour
  80   1          if(num==2){P1=0x04&aa;P0=c;delay(2);}else{P1=0x04;P0=c;delay(2);} //min
  81   1          if(num==2){P1=0x08&aa;P0=d;delay(2);}else{P1=0x08;P0=d;delay(2);} //min
  82   1          if(num==3){P1=0x10&aa;P0=e;delay(2);}else{P1=0x10;P0=e;delay(2);} //sec
  83   1          if(num==3){P1=0x20&aa;P0=f;delay(2);}else{P1=0x20;P0=f;delay(2);} //sec
  84   1              
  85   1      }
  86          
  87          /************** 定时器0中断函数  ***************/
  88          void timer0() interrupt 1 
  89          {
  90   1              TH0=(65536-50000)/256;
  91   1              TL0=(65536-50000)%256;
  92   1              temp++;
  93   1              
  94   1      }
  95          
  96          /************** 定时器1中断函数  ***************/
  97          void timer1() interrupt 3 
  98          {
  99   1              TH1=(65536-50000)/256;
 100   1              TL1=(65536-50000)%256;
 101   1              count++;
 102   1              if(count>=20)
 103   1              count=0;
 104   1              
 105   1      }
 106          
 107          /****************** 延时子函数  *******************/
 108          void delay(uint z)
 109          {
 110   1         uint j,k;
 111   1         for(j=z;j>0;j--)
 112   1           for(k=120;k>0;k--);
 113   1      }
 114          
 115          /****************** 读按键函数  *******************/
 116          void read_key()
 117          {
C51 COMPILER V8.02   SHIZHONG2                                                             08/10/2009 08:55:36 PAGE 3   

 118   1          if(key1==0)
 119   1          {    
 120   2                  _led=0;
 121   2              delay(50);
 122   2              if(key1==0)
 123   2              {
 124   3                      
 125   3                  num++;
 126   3                  if(num>3){num=0;}
 127   3              }
 128   2                  while(!key1);
 129   2                      delay(10);
 130   2                      while(!key1);
 131   2                      _led=1; 
 132   2                      
 133   2          }
 134   1              
 135   1          if(key2==0)
 136   1          {   
 137   2                  _led=0;
 138   2              delay(90);
 139   2              if(key2==0)
 140   2              {
 141   3                  if(num==1){hour++;if(hour==24)hour=0;}
 142   3                  if(num==2){min++;if(min==60)min=0;}
 143   3                  if(num==3){sec++;if(sec==60)sec=0;}
 144   3              }
 145   2                      while(!key1);
 146   2                      delay(10);
 147   2                      while(!key1);
 148   2                      _led=1;
 149   2              
 150   2          }
 151   1       
 152   1          if(key3==0)
 153   1          {   
 154   2                  _led=0;
 155   2              delay(90);
 156   2              if(key3==0)
 157   2              {
 158   3                  
 159   3                              if(num==1){hour--;if(hour==0)hour=23;}                          
 160   3                  if(num==2){min--;if(min==0)min=59;}
 161   3                  if(num==3){sec--;if(sec==59)sec=59;}
 162   3              }
 163   2                      while(!key1);
 164   2                      delay(10);
 165   2                      while(!key1);
 166   2                      _led=1;
 167   2          }
 168   1      }


MODULE INFORMATION:   STATIC OVERLAYABLE
   CODE SIZE        =    625    ----
   CONSTANT SIZE    =     10    ----
   XDATA SIZE       =   ----    ----
   PDATA SIZE       =   ----    ----
   DATA SIZE        =      7       7
   IDATA SIZE       =   ----    ----
   BIT SIZE         =   ----    ----
END OF MODULE INFORMATION.

C51 COMPILER V8.02   SHIZHONG2                                                             08/10/2009 08:55:36 PAGE 4   


C51 COMPILATION COMPLETE.  0 WARNING(S),  0 ERROR(S)
